# Things to consider

## Nodes
| Category                        | Current                                                                                  | Proposed addition / change                                                                                                    | Benefits                                                                                                                                                                                                                                                                                                                     | Drawbacks / Risks                                                                                                                                                                                                                                          |
| ------------------------------- | ---------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Address node (unified)**      | Separate `sender` and `receiver` node types.                                             | Single `Address` node representing an email address identity; optionally keep sender/receiver alias nodes for directionality. | - Collapses duplicate representations for the same address.<br>- Enables **reputation, temporal, and behavioral** features (send volume, first_seen, etc.).<br>- Improves graph connectivity and allows label/embedding propagation between send and receive contexts.<br>- Simplifies feature aggregation (no duplication). | - Requires aggregation of historical stats (may need full dataset, not just reported emails).<br>- Breaks clean bipartite structure (email→sender, email→receiver) unless alias layer retained.<br>- Slightly more complex schema and feature engineering. |
| **Domain node (sender vs URL)** | Two distinct domain types: `domain` (for URLs) and `email_domain` (for sender/receiver). | Unify or relate via shared “Domain” node; extend features (WHOIS age, reputation, MX/ASN/TLD).                                | - Avoids domain duplication (same string in multiple node sets).<br>- Allows **shared infrastructure reasoning** (phishers often reuse same domain for email and hosting).<br>- WHOIS and reputation features strengthen malicious clustering.<br>- Connects email delivery infrastructure with payload infrastructure.      | - Adds external data dependency (WHOIS / reputation feeds).<br>- If you merge aggressively, legitimate overlap (e.g. gmail.com) could create massive hubs; must handle via whitelisting or down-weighting.                                                 |
| **URL node**                    | URL node with only length feature; connected to domain and stem.                         | Enrich URL node with lexical and reputation features; maintain domain & stem substructure.                                    | - Distinguishes malicious URLs beyond lexical similarity.<br>- Reputation, redirect-chain, and path features capture behavioral risk.<br>- Helps detect campaign patterns sharing landing pages.                                                                                                                             | - Reputation feeds or redirect tracing require external lookups.<br>- Risk of noisy or missing data for ephemeral URLs.                                                                                                                                    |
| **Attachment node**             | None.                                                                                    | Introduce node keyed by attachment hash (SHA256/MD5) with edges `email→attachment`.                                           | - **Strong exact-match signal** for campaign linking (same file across multiple emails).<br>- Minimal false positives.<br>- Attachment-level features (MIME, entropy, malware flag) are highly predictive.                                                                                                                   | - Adds preprocessing (hash extraction, MIME detection).<br>- Potentially increases node/edge count (but usually moderate).<br>- Privacy & storage concerns for binary samples.                                                                             |
| **IP / ASN / Thread nodes**     | None.                                                                                    | Nodes for sending IP, resolved IP of URLs, or conversation thread (based on message-id / references).                         | - Infrastructure reuse detection (same sending IP/ASN across campaigns).<br>- Thread nodes can capture conversation structure if available.                                                                                                                                                                                  | - Requires full header data and/or DNS logs.<br>- May have poor coverage; added complexity for limited benefit if dataset is small or anonymized.                                                                                                          |
| **Week (time bucket)**          | Present (email→week).                                                                    | Keep; possibly extend to finer temporal edges (see below).                                                                    | - Provides time-window context without creating dense temporal edges.                                                                                                                                                                                                                                                        | - Coarse; loses continuity inside week if high-volume dataset.                                                                                                                                                                                             |


## Edges
| Edge type                                        | Current                             | Proposed addition / change                                                                           | Benefits                                                                                                             | Drawbacks / Risks                                                                                                                                          |
| ------------------------------------------------ | ----------------------------------- | ---------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Thread / In-Reply-To (email→email)**           | None.                               | Add edges linking emails by message-id / in-reply-to / references.                                   | - Captures reply chains, label propagation, conversation context.<br>- Useful for “fake reply” campaigns.            | - Rare in reported-phish datasets.<br>- Low coverage; may add sparse/noisy edges.<br>- Adds complexity for little gain unless you have real threads.       |
| **Same-attachment (email↔attachment)**           | None.                               | Connect emails sharing identical attachment hash.                                                    | - Strong deterministic linkage across campaigns; low false positive.<br>- High-value signal for clustering.          | - Requires attachment extraction + hashing pipeline.<br>- Limited coverage if few emails have attachments.                                                 |
| **Contains URL / hosted on domain**              | Present: `email→url`, `url→domain`. | Keep; maybe add weight based on URL reputation or domain reputation.                                 | - Already well-designed; weighting adds expressiveness.                                                              | - Reputation data optional.                                                                                                                                |
| **Temporal proximity (email↔email)**             | Indirect: email→week.               | Add explicit edges between emails close in time (same sender within Δt).                             | - Preserves continuity within campaigns; improves temporal propagation.                                              | - Must tune window; risk of linking unrelated emails if sender is high-volume.                                                                             |
| **Content similarity (email↔email)**             | None (x_text placeholder).          | Compute cosine similarity between text embeddings (subject+body) and add top-k or thresholded edges. | - Captures **semantic similarity** between phish variants.<br>- Greatly improves clustering of near-duplicate lures. | - Risk of spurious connections if embeddings noisy.<br>- May create dense graph; must use kNN or threshold carefully.<br>- Need embedding model + compute. |
| **Co-recipient / co-list (address↔address)**     | None.                               | Connect addresses that appear together frequently in To/Cc.                                          | - Reveals group-targeted campaigns.<br>- Useful for clustering recipients of same phish.                             | - Needs enough co-occurrence data; can explode edge count in mailing lists.<br>- Privacy concern if recipients are users.                                  |
| **Infrastructure edges (sender→IP, domain→ASN)** | None.                               | Add if header data available.                                                                        | - Enables reasoning about shared infrastructure.<br>- Improves generalization across campaign variants.              | - Requires extra enrichment; increases heterogeneity.                                                                                                      |


## Node Features
| Node type               | Current features                                             | Missing / proposed                                                                                                                                             | Benefits                                                                                                                                                                       | Drawbacks / Risks                                                                                                          |
| ----------------------- | ------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------- |
| **Email**               | `[len_subject, len_body, n_urls, ts]` + zero text embedding. | Add: text embedding (`x_text`), language, attachment count, URL/domain reputation summary, header boolean flags (SPF/DKIM/DMARC, From-ReturnPath consistency). | - Text embeddings unlock **semantic similarity** edges and message-level clustering.<br>- Header booleans add infrastructure trust cues.<br>- Better represent attack tactics. | - Embedding computation cost.<br>- Some headers missing or inconsistent.<br>- Need normalization to avoid scale imbalance. |
| **Address / Sender / Receiver**             | String length only (sender/receiver).                        | Add: send rate, first/last seen, reputation, aggregated embedding (mean of sent emails).                                                                       | - Captures behavioral patterns (burst sending, reputation).<br>- Supports reputation propagation.                                                                              | - Requires aggregation pipeline and temporal stats.                                                                        |
| **Domain / URL / Stem** | Lexical features, docfreq counts.                            | Add: TLD bucket, reputation, WHOIS age, MX/ASN, redirect-chain features.                                                                                       | - Adds **infrastructure intelligence** that’s orthogonal to content.<br>- Helps link infrastructure reuse.                                                                     | - External data dependency; might be incomplete for obscure domains.                                                       |
| **Attachment**          | N/A.                                                         | MIME type, entropy, file size bucket, malware flag.                                                                                                            | - Highly predictive of maliciousness; great exact-match feature.                                                                                                               | - Requires binary metadata extraction; potential sensitivity.                                                              |
| **Normalization**       | None.                                                        | Apply per-feature z-score or min-max normalization.                                                                                                            | - Essential for stable training; avoids dominance of large-scale features (e.g., timestamp).                                                                                   | - Need consistent scaling across batches; trivial but must implement.                                                      |


## Structural / Normalization / Meta changes
| Area                   | Current                                   | Proposed                                                  | Benefits                                                               | Drawbacks / Risks                                                     |
| ---------------------- | ----------------------------------------- | --------------------------------------------------------- | ---------------------------------------------------------------------- | --------------------------------------------------------------------- |
| **Normalization**      | Raw values written directly into tensors. | z-score or min-max per feature, per node type.            | - Prevents training instability and helps model convergence.           | - Requires pre-computation of feature statistics.                     |
| **Edge weights**       | Unweighted.                               | Add semantic weights (similarity, reputation, frequency). | - Encodes relation strength; lets model focus attention appropriately. | - Requires calibration; may not matter if using attention-based GNNs. |
| **Graph connectivity** | Moderate; edges centered on email.        | More cross-type edges (attachments, domains, addresses).  | - Improves information propagation and potential cluster integrity.    | - Graph becomes denser; risk of oversmoothing if not pruned.          |
